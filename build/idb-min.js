var idb=function(e){"use strict";const n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction],t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey],r=new WeakMap,o=new WeakMap,s=new WeakMap,i=new WeakMap,a=(e,n)=>n.some(n=>e instanceof n);const c={get:(e,n)=>"done"===n&&e instanceof IDBTransaction?o.get(e):d(e[n])};function u(e){return"function"==typeof e?(s=e,t.includes(s)?function(...e){const n=p(this);return s.apply(n,e),d(r.get(this))}:function(...e){const n=p(this);return d(s.apply(n,e))}):(e instanceof IDBTransaction&&function(e){if(o.has(e))return;const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),r()},s=()=>{t(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});o.set(e,n)}(e),a(e,n)?new Proxy(e,c):e);var s}function d(e){if(e instanceof IDBRequest)return function(e){const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(d(e.result)),r()},s=()=>{t(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return n.then(n=>{n instanceof IDBCursor&&r.set(n,e)}),i.set(n,e),n}(e);if(s.has(e))return s.get(e);const n=u(e);return n!==e&&(s.set(e,n),i.set(n,e)),n}const p=e=>i.get(e);return e.openDb=function(e,n,t={}){const{blocked:r,upgrade:o,blocking:s}=t,i=indexedDB.open(e,n),a=d(i);return o&&i.addEventListener("upgradeneeded",e=>{o(d(i.result),e.oldVersion,e.newVersion,d(i.transaction))}),r&&i.addEventListener("blocked",()=>r()),s&&a.then(e=>e.addEventListener("versionchange",s)),a},e.deleteDb=function(e){return d(indexedDB.deleteDatabase(e))},e.unwrap=p,e}({});

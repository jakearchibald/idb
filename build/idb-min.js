var idb=function(e){"use strict";const n=(e,n)=>n.some(n=>e instanceof n);let t,r;const o=new WeakMap,s=new WeakMap,i=new WeakMap,a=new WeakMap;let c={get:(e,n)=>"done"===n&&e instanceof IDBTransaction?s.get(e):l(e[n]),has:(e,n)=>"done"===n&&e instanceof IDBTransaction||n in e};function u(e){c=e(c)}function d(e){return(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]),r).includes(e)?function(...n){const t=p(this);return e.apply(t,n),l(o.get(this))}:function(...n){const t=p(this);return l(e.apply(t,n))}}function f(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(s.has(e))return;const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),r()},s=()=>{t(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});s.set(e,n)}(e),n(e,(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]),t))?new Proxy(e,c):e)}function l(e){if(e instanceof IDBRequest)return function(e){const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(l(e.result)),r()},s=()=>{t(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return n.then(n=>{n instanceof IDBCursor&&o.set(n,e)}),a.set(n,e),n}(e);if(i.has(e))return i.get(e);const n=f(e);return n!==e&&(i.set(e,n),a.set(n,e)),n}function p(e){return a.get(e)}function D(e,n){return e instanceof IDBDatabase&&!(n in e)&&"string"==typeof n}const v=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"];v.push(...v.map(e=>e+"Index"));const h=new Map;async function*B(){let e=this;for(e instanceof IDBCursor||(e=await e.openCursor()),e=e;e;)e instanceof IDBCursorWithValue?yield[e.key,e.value]:yield e.key,e=await e.continue()}function g(e,t){return t===Symbol.asyncIterator&&n(e,[IDBCursor,IDBObjectStore,IDBIndex])}return u(e=>({get(n,t,r){if(!D(n,t))return e.get(n,t,r);t=t;const o=h.get(t);if(o)return o;const s=function(e){return v.includes(e)?function(n,...t){let r="",o=e;o.endsWith("Index")&&(r=t.shift(),o=o.slice(0,-5));let s=this.transaction(n).objectStore(n);return r&&(s=s.index(r)),s[o](...t)}:I.includes(e)?function(n,...t){const r=this.transaction(n,"readwrite");return r.objectStore(n)[e](...t),r.done}:void 0}(t);return s?(h.set(t,s),s):e.get(n,t,r)},has:(n,t)=>D(n,t)&&(v.includes(t)||I.includes(t))||e.has(n,t)})),u(e=>({get:(n,t,r)=>g(n,t)?B:e.get(n,t,r),has:(n,t)=>g(n,t)||e.has(n,t)})),e.openDb=function(e,n,t={}){const{blocked:r,upgrade:o,blocking:s}=t,i=indexedDB.open(e,n),a=l(i);return o&&i.addEventListener("upgradeneeded",e=>{o(l(i.result),e.oldVersion,e.newVersion,l(i.transaction))}),r&&i.addEventListener("blocked",()=>r()),s&&a.then(e=>e.addEventListener("versionchange",s)),a},e.deleteDb=function(e,n={}){const{blocked:t}=n,r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",()=>t()),l(r).then(()=>void 0)},e.unwrap=p,e.wrap=l,e}({});

var idb=function(e){"use strict";let n,t;const r=new WeakMap,o=new WeakMap,s=new WeakMap,i=new WeakMap,a=(e,n)=>n.some(n=>e instanceof n);const c={get:(e,n)=>"done"===n&&e instanceof IDBTransaction?o.get(e):p(e[n]),has:(e,n)=>"done"===n&&e instanceof IDBTransaction||n in e};function u(e){return(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]),t).includes(e)?function(...n){const t=v(this);return e.apply(t,n),p(r.get(this))}:function(...n){const t=v(this);return p(e.apply(t,n))}}function d(e){return"function"==typeof e?u(e):(e instanceof IDBTransaction&&function(e){if(o.has(e))return;const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",s),e.removeEventListener("abort",s)},o=()=>{n(),r()},s=()=>{t(e.error),r()};e.addEventListener("complete",o),e.addEventListener("error",s),e.addEventListener("abort",s)});o.set(e,n)}(e),a(e,(n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]),n))?new Proxy(e,c):e)}function p(e){if(e instanceof IDBRequest)return function(e){const n=new Promise((n,t)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",s)},o=()=>{n(p(e.result)),r()},s=()=>{t(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",s)});return n.then(n=>{n instanceof IDBCursor&&r.set(n,e)}),i.set(n,e),n}(e);if(s.has(e))return s.get(e);const n=d(e);return n!==e&&(s.set(e,n),i.set(n,e)),n}function v(e){return i.get(e)}return e.openDb=function(e,n,t={}){const{blocked:r,upgrade:o,blocking:s}=t,i=indexedDB.open(e,n),a=p(i);return o&&i.addEventListener("upgradeneeded",e=>{o(p(i.result),e.oldVersion,e.newVersion,p(i.transaction))}),r&&i.addEventListener("blocked",()=>r()),s&&a.then(e=>e.addEventListener("versionchange",s)),a},e.deleteDb=function(e,n={}){const{blocked:t}=n,r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",()=>t()),p(r).then(()=>void 0)},e.unwrap=v,e.wrap=p,e}({});
